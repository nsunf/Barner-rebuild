extends layout 

block styles 
  link(rel='stylesheet', href='/stylesheets/product_detail_style.css')

block content 
  -
    function getFileNameFromImgURL(url) {
      let startIndex = url.indexOf('products/');
      let endIndex = url.indexOf('?v=');
      return url.slice(startIndex + 9, endIndex);
    }

    let fileNamePrefix = product_data.productName.replace(" ", "_") + "_" + product_data.productColor.replace(" ", "_");
  .main
    .main__top 
      .top__inner
        .top__product.product 
          .product__image
            if category == "Eyeglasses"
              img(src="../../../images/glasses/" + fileNamePrefix + "_front.jpg", alt="image")
            else 
              img(src="../../../images/sunglasses/" + fileNamePrefix + "_front.jpg", alt="image")
          .product__shop
            .product__context
              .context__title
                h1.context__title--name=product_data.productName
                span.context__title--color=product_data.productColor
              .context__price
                if product_data.productDisCountedPrice
                    span.context__price--og-price=product_data.productPrice
                    span.context__price--price=product_data.productDisCountedPrice
                else
                    span.context__price--price=product_data.productPrice
            .product__description
              p High quality and stylish computer glasses to protect your eyes from Blue Light of digital devices. It will provide you with better sleep and a healthier life.
            .product__color-set.color-set
              .color-set__inner
                each color in product_data.colorSet
                  - let path = "../../../images/colorImages/" + color.replace(" ", "-") + ".png";
                  if color.toLowerCase() == product_data.productColor.toLowerCase()
                    .color__item.color__item--selected 
                      svg(viewbox="0 0 32 32" width="50px" hieght="50px")
                        image(href=path width="50px" height="50px" x="16px" y="16px" style="transform: translate(-25px, -25px)")
                  else
                    .color__item 
                      svg(viewbox="0 0 32 32" width="50px" hieght="50px")
                        image(href=path width="50px" height="50px" x="16px" y="16px" style="transform: translate(-25px, -25px)")
            .btn
              input.btn--add-to-cart(type="button" value="Add To Cart")
        .top__aside.aside.flex--center
          .aside__inner 
            each index in [0, 1, 2]
              -
                let randomNum = Math.floor(Math.random() * product_data_list.length);
                let product = product_data_list[randomNum];
                let asideFileName = product.productName.replace(" ", "_") + "_" + product.productColor.replace(" ", "_") + "_front.jpg"
                let path = category == "Eyeglasses" ? "../../../images/glasses/" + asideFileName : "../../../images/sunglasses/" + asideFileName;
              .another-product
                img(src=path, alt="image")
    .line--divider
    .main__body
      .body__section
        .description
          .paragraph-wrap
            p!= product_data.asides.join("<br/><br/>")
          .line--horizontal
        .img-wrap
          if category == "Eyeglasses"
            - 
              let sideImgUrl = "../../../images/glasses/" + fileNamePrefix + "_side.jpg";
              let spareImgUrl = "../../../images/glasses/" + fileNamePrefix + "_etc_0.jpg";
            img(src=sideImgUrl, alt="" onerror="this.src='" + spareImgUrl + "'")
          else
            - let sideImgUrl = "../../../images/sunglasses/" + fileNamePrefix + "_model1-1.jpg";
            img(src=sideImgUrl, alt="")

      .body__section
        .img-wrap
          - 
            let upAngleImgUrl = category == "Eyeglasses" ? "../../../images/glasses/" + fileNamePrefix + "_upAngle.jpg" : "../../../images/sunglasses/" + fileNamePrefix + "_upAngle.jpg";
            let lensMaterial = product_data.additionalInfo.filter(x => x.title == "Lens Material")[0].contents;
            let frameMaterial = product_data.additionalInfo.filter(x => x.title == "Frame Material")[0].contents;
          svg(viewbox="0 0 1240 1240")
            image(href=upAngleImgUrl)
            circle(cx="220" cy="640" r="16" fill="#6668e2")
            path(d="M220 640 l 100 400 h 200" fill="none" stroke="#6668e2" stroke-width="2")
            text(x="336" y="1024" font-size="3em" font-family="Avenir" font-weight="900" fill="#6668e2")= lensMaterial

            if frameMaterial.includes("/")
              -
                let frontMat = frameMaterial.match(/(?<=- ).+(?= \/)/g); 
                let templesMat = frameMaterial.match(/(?<=: ).+/g);
              circle(cx="640" cy="456" r="16" fill="#6668e2")
              path(d="M640 456 l 80 -160 h 200" fill="none" stroke="#6668e2" stroke-width="2")
              text(x="736" y="280" font-size="3em" font-family="Avenir" font-weight="900" fill="#6668e2")= templesMat

              circle(cx="690" cy="700" r="16" fill="#6668e2")
              path(d="M690 700 l 50 200 h 200" fill="none" stroke="#6668e2" stroke-width="2")
              text(x="756" y="884" font-size="3em" font-family="Avenir" font-weight="900" fill="#6668e2")= frontMat
            else
              circle(cx="220" cy="640" r="16" fill="#6668e2")
              path(d="M220 640 l 100 400 h 200" fill="none" stroke="#6668e2" stroke-width="2")
              text(x="336" y="1024" font-size="3em" font-family="Avenir" font-weight="900" fill="#6668e2")= lensMaterial

              circle(cx="690" cy="700" r="16" fill="#6668e2")
              path(d="M690 700 l 50 200 h 200" fill="none" stroke="#6668e2" stroke-width="2")
              text(x="756" y="884" font-size="3em" font-family="Avenir" font-weight="900" fill="#6668e2")= frameMaterial
          
        .description
          .list-wrap 
            ul 
              each spec in product_data.additionalInfo
                li= spec.title
                  span  : 
                  span= spec.contents

      .body__section
        .grid.grid--left
          - let packageImgUrl = category == "Eyeglasses" ? "../../../images/glasses/" + fileNamePrefix + "_package.jpg" : "../../../images/sunglasses/" + fileNamePrefix + "_front.jpg";
          img(src= packageImgUrl, alt="")

        .grid.grid--right
          - let aaa = category == "Eyeglasses" ? "../../../images/glasses/" + fileNamePrefix : "../../../images/sunglasses/" + fileNamePrefix;

          img(src=aaa + "_model1-1.jpg", alt="")
          img(src=aaa + "_model2-1.jpg", alt="")
          img(src=aaa + "_model1-2.jpg", alt="")
          img(src=aaa + "_model2-2.jpg", alt="")
  section.main__footer.flex--center
      a(href="/") Back to Main